---
title: Monitor your chain with Dispute Monitor
description: Learn how to set up op-dispute-mon to monitor dispute games and fault proof activity on your L2 rollup.
---

Now that you have a running OP Stack rollup with fault proofs enabled, it's critical to monitor your dispute games to ensure your chain operates securely. This tutorial will guide you through setting up `op-dispute-mon` to track all dispute game activity on your rollup.

<Info>
  This tutorial continues from the previous steps in [Creating Your Own L2 Rollup](/operators/chain-operators/tutorials/create-l2-rollup). Make sure you have completed the op-challenger setup and have dispute games running before proceeding.
</Info>

## What you'll set up

By the end of this tutorial, you'll have:

*   **op-dispute-mon** monitoring all dispute games on your chain
*   **Real-time tracking** of game status, agreements, and honest actor participation
*   Understanding of key metrics for dispute game health

## Prerequisites

Before you begin, ensure you have:

*   Completed all previous steps in the [Creating Your Own L2 Rollup tutorial](/operators/chain-operators/tutorials/create-l2-rollup)
*   op-challenger running and participating in dispute games
*   op-proposer running and creating proposals
*   L1 RPC endpoint with sufficient rate limits
*   Rollup RPC endpoint (op-node)
*   Docker installed (for Docker setup) OR Go 1.21+ (for build from source)

## What is op-dispute-mon?

`op-dispute-mon` is a specialized monitoring tool that tracks dispute games in the fault proof system. It provides visibility into:

*   **Game status**: Track games from creation to resolution
*   **Honest actor participation**: Monitor your proposer and challenger activity
*   **Agreement tracking**: See which games agree/disagree with your honest actors
*   **Game completion**: Monitor in-progress vs completed games
*   **Ignored games**: Track games that don't meet monitoring criteria

The monitor exposes Prometheus metrics that can be used to build dashboards and alerts.

<Steps>
<Step title="Choose deployment method">

This tutorial supports two deployment methods. Choose the one that best fits your needs:

*   **Docker (Recommended)**: Easiest to set up and maintain. All dependencies are containerized.
*   **Build from Source**: More control over the build process. Useful for development or custom deployments.

The following steps will show instructions for both methods where they differ.

</Step>

<Step title="Create dispute-mon directory">

Set up the directory structure for your dispute monitor.

```bash
# From your project root
cd rollup
mkdir -p dispute-mon/scripts
cd dispute-mon
```

</Step>

<Step title="Get required addresses">

Extract the necessary addresses from your deployment state.

```bash
# Get DisputeGameFactory address from deployment
export GAME_FACTORY_ADDRESS=$(jq -r '.opChainDeployments[0].DisputeGameFactoryProxy' ../deployer/.deployer/state.json)
echo "Game Factory Address: $GAME_FACTORY_ADDRESS"

# Get Proposer address
export PROPOSER_ADDRESS=$(jq -r '.appliedIntent.chains[0].roles.proposer' ../deployer/.deployer/state.json)
echo "Proposer Address: $PROPOSER_ADDRESS"

# Get Challenger address
export CHALLENGER_ADDRESS=$(jq -r '.appliedIntent.chains[0].roles.challenger' ../deployer/.deployer/state.json)
echo "Challenger Address: $CHALLENGER_ADDRESS"

# Get L1 RPC URL
source ../.env
echo "L1 RPC: $L1_RPC_URL"
```

</Step>

<Step title="Configure op-dispute-mon">

Choose your deployment method and create the necessary configuration files.

<Tabs>
<Tab title="Use Docker (Recommended)">

Create `docker-compose.yml` with the following configuration:

```yaml
version: "3.8"

services:
  op-dispute-mon:
    image: us-docker.pkg.dev/oplabs-tools-artifacts/images/op-dispute-mon:v1.4.2-rc.1
    container_name: dispute-mon
    ports:
      - "7300:7300" # Metrics port
    environment:
      # L1 RPC Configuration
      - OP_DISPUTE_MON_L1_ETH_RPC=https://sepolia.infura.io/v3/YOUR_INFURA_KEY
      
      # Rollup RPC Configuration (your op-node)
      - OP_DISPUTE_MON_ROLLUP_RPC=http://op-node:8547
      
      # Honest Actors (your proposer and challenger addresses)
      - OP_DISPUTE_MON_HONEST_ACTORS=${PROPOSER_ADDRESS},${CHALLENGER_ADDRESS}
      
      # DisputeGameFactory Contract Address
      - OP_DISPUTE_MON_GAME_FACTORY_ADDRESS=${GAME_FACTORY_ADDRESS}
      
      # Monitoring Configuration
      - OP_DISPUTE_MON_MONITOR_INTERVAL=10s
      - OP_DISPUTE_MON_NETWORK=op-sepolia
      
      # Logging Configuration
      - OP_DISPUTE_MON_LOG_FORMAT=logfmt
      - OP_DISPUTE_MON_LOG_LEVEL=debug
      
      # Metrics Configuration
      - OP_DISPUTE_MON_METRICS_ADDR=0.0.0.0
      - OP_DISPUTE_MON_METRICS_ENABLED=true
      - OP_DISPUTE_MON_METRICS_PORT=7300
    restart: unless-stopped
    networks:
      - dispute-mon-network

networks:
  dispute-mon-network:
    driver: bridge
```

<Warning>
  Replace `YOUR_INFURA_KEY` with your actual Infura API key or use another L1 RPC provider. Make sure your L1 RPC has sufficient rate limits for production use.
</Warning>

</Tab>

<Tab title="Build from Source">

First, build op-dispute-mon from source:

```bash
# From your project root
cd optimism

# Pull latest changes
git pull

# Build op-dispute-mon
cd op-dispute-mon
make op-dispute-mon

# Verify the build
./bin/op-dispute-mon --version

# Return to project root
cd ../..
```

Then create the environment file:

```bash
cat > .env << EOF
# L1 Configuration
L1_RPC_URL=$L1_RPC_URL

# Rollup Configuration  
ROLLUP_RPC=http://localhost:8547

# Contract Addresses
GAME_FACTORY_ADDRESS=$GAME_FACTORY_ADDRESS

# Honest Actors
PROPOSER_ADDRESS=$PROPOSER_ADDRESS
CHALLENGER_ADDRESS=$CHALLENGER_ADDRESS

# Network Configuration
NETWORK=op-sepolia

# Monitoring Configuration
MONITOR_INTERVAL=10s

# Logging Configuration
LOG_LEVEL=info
LOG_FORMAT=logfmt

# Metrics Configuration
METRICS_ADDR=0.0.0.0
METRICS_ENABLED=true
METRICS_PORT=7300
EOF
```

Now create the startup script `scripts/start-dispute-mon.sh`:

```bash
#!/bin/bash
set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Change to dispute-mon directory
cd "$SCRIPT_DIR/.."

# Load environment variables
source .env

# Path to op-dispute-mon binary
DISPUTE_MON_BIN="$PROJECT_ROOT/optimism/op-dispute-mon/bin/op-dispute-mon"

# Check if binary exists
if [ ! -f "$DISPUTE_MON_BIN" ]; then
    echo "Error: op-dispute-mon binary not found at $DISPUTE_MON_BIN"
    echo "Please build op-dispute-mon first:"
    echo "  cd $PROJECT_ROOT/optimism/op-dispute-mon"
    echo "  make op-dispute-mon"
    exit 1
fi

echo "Starting op-dispute-mon..."
echo "Game Factory: $GAME_FACTORY_ADDRESS"
echo "Proposer: $PROPOSER_ADDRESS"
echo "Challenger: $CHALLENGER_ADDRESS"

$DISPUTE_MON_BIN \
  --l1-eth-rpc=$L1_RPC_URL \
  --rollup-rpc=$ROLLUP_RPC \
  --game-factory-address=$GAME_FACTORY_ADDRESS \
  --honest-actors=$PROPOSER_ADDRESS,$CHALLENGER_ADDRESS \
  --network=$NETWORK \
  --monitor-interval=$MONITOR_INTERVAL \
  --log.level=$LOG_LEVEL \
  --log.format=$LOG_FORMAT \
  --metrics.enabled=$METRICS_ENABLED \
  --metrics.addr=$METRICS_ADDR \
  --metrics.port=$METRICS_PORT
```

Make it executable:

```bash
chmod +x scripts/start-dispute-mon.sh
```

</Tab>
</Tabs>

</Step>

<Step title="Start op-dispute-mon">

Launch the dispute monitor using your chosen deployment method.

<Tabs>
<Tab title="Use Docker (Recommended)">

```bash
# Export variables
export PROPOSER_ADDRESS=0xYourProposerAddress
export CHALLENGER_ADDRESS=0xYourChallengerAddress
export GAME_FACTORY_ADDRESS=0xYourGameFactoryAddress

# Start the container
docker-compose up -d

# View logs
docker-compose logs -f op-dispute-mon
```

</Tab>

<Tab title="Build from Source">

```bash
# Start in foreground (for testing)
./scripts/start-dispute-mon.sh

# Or start in background with logging
mkdir -p logs
./scripts/start-dispute-mon.sh > logs/dispute-mon.log 2>&1 &

# Save the process ID
echo $! > dispute-mon.pid
```

</Tab>
</Tabs>

</Step>

<Step title="Verify it's running">

Check that the dispute monitor is operational.

<Tabs>
<Tab title="Use Docker (Recommended)">

Check the metrics endpoint:

```bash
# Query metrics endpoint
curl http://localhost:7300/metrics

# You should see Prometheus metrics including:
# - op_dispute_mon_games_agreement
# - op_dispute_mon_ignored_games
# - and many more...
```

Check logs for any errors:

```bash
# View recent logs
docker-compose logs --tail=50 op-dispute-mon
```

You should see logs indicating the monitor is tracking games:

```bash
t=2025-10-21T05:58:52+0100 lvl=info msg="Starting op-dispute-mon" version=untagged-48e52dc5-1759893117
t=2025-10-21T05:58:52+0100 lvl=info msg="started metrics server" addr=[::]:7300
t=2025-10-21T05:58:52+0100 lvl=info msg="Starting scheduler"
t=2025-10-21T05:58:52+0100 lvl=info msg="Starting monitoring"
t=2025-10-21T05:58:52+0100 lvl=info msg="Completed monitoring update" blockNumber=9456908 duration=599.887083ms games=0 ignored=0 failed=0
```

</Tab>

<Tab title="Build from Source">

Check if the process is running:

```bash
# Check if process is running
ps aux | grep op-dispute-mon

# Query metrics endpoint
curl http://localhost:7300/metrics

# Check logs
tail -f logs/dispute-mon.log
```

</Tab>
</Tabs>

</Step>

<Step title="Understand key metrics">

Once op-dispute-mon is running, it exposes several important metrics that help you monitor dispute game health.

Access the metrics endpoint:

```bash
curl http://localhost:7300/metrics | grep op_dispute_mon
```

**Game agreement metrics:**

The dispute monitor tracks games and categorizes them by completion status and agreement with your honest actors:

```
op_dispute_mon_games_agreement{completion="complete",result_correctness="correct",root_agreement="agree",status="agree_defender_wins"} 0
op_dispute_mon_games_agreement{completion="in_progress",result_correctness="correct",root_agreement="agree",status="agree_defender_ahead"} 0
```

**What to monitor:**
- Any non-zero value for `root_agreement="disagree"` requires immediate investigation
- Games with `completion="in_progress"` are actively being disputed
- For a new testnet, all values being `0` is normal (no disputes yet)

**Ignored games:**

```
op_dispute_mon_ignored_games 0
```

This tracks games that don't meet your monitoring criteria (e.g., games not involving your honest actors).

**Failed games:**

```
op_dispute_mon_failed_games 0
```

This tracks games that failed to be monitored due to errors.

**Monitor status:**

```
op_dispute_mon_up 1
```

This should always be `1` when the monitor is running properly. If `0`, the monitor hasn't fully initialized.

**Honest actor bonds:**

```
op_dispute_mon_honest_actor_bonds{honest_actor_address="0xYourAddress",state="pending"} 0
op_dispute_mon_honest_actor_bonds{honest_actor_address="0xYourAddress",state="won"} 0
op_dispute_mon_honest_actor_bonds{honest_actor_address="0xYourAddress",state="lost"} 0
```

This tracks the bonds posted by your proposer and challenger, and whether they were won or lost.

**Query examples:**

```bash
# Check monitor status
curl -s http://localhost:7300/metrics | grep "op_dispute_mon_up"

# Check for any games being monitored
curl -s http://localhost:7300/metrics | grep -E "op_dispute_mon_(games|ignored|failed)"

# View all game agreement metrics
curl -s http://localhost:7300/metrics | grep "op_dispute_mon_games_agreement"
```

<Info>
These metrics are based on the actual op-dispute-mon v1.4.2 implementation. Values will be `0` for new testnets until dispute games are created.
</Info>

</Step>

<Step title="Monitor dispute game health">

Use these practices to ensure your dispute games are healthy.

**Immediate attention required:**
- Any `agreement="disagree"` metrics
- Honest actor metrics stop increasing
- High number of ignored games involving your actors
- Errors in logs about RPC connectivity
- Errors about invalid game states

**Investigate soon:**
- Games stuck in `in_progress` for >7 days
- Sudden drop in game creation rate
- Increase in `defender_wins` status

**Normal operation:**
- Regular game creation
- All agreements showing `agree`
- Games completing within challenge period
- Occasional `challenger_wins` (other proposals being challenged)

</Step>
</Steps>

## Next steps

Now that you have dispute game monitoring set up, you can:

*   Create alerting for critical metrics like disagreements
*   Explore the [Dispute monitor tool reference](/operators/chain-operators/tools/chain-monitoring)
*   Learn more about the [fault proof system](/stack/fault-proofs/explainer)
*   Set up [Prometheus](https://prometheus.io/docs/) and [Grafana](https://grafana.com/docs/) for advanced metrics visualization (optional)

Congratulations! You now have a fully operational OP Stack L2 rollup with comprehensive monitoring.